This file contains the design document for the complete web framework. Meant for development.

## Basic App

```ts
import { Blurr } from 'blurr';

const app = new Blurr();
```

Possible configuration:

```ts
import type { App } from 'blurr';

const db = new Database();

const app = new Blurr({
  // The types in the state are preserved. Figure out a way to achieve so
  state: {
    name: 'John Doe',
    db: db
  },
  // Autogenerated redoc/swagger docs - decide which, or allow both?
  docs: {
    redoc: '/redoc',
    swagger: '/swagger'
  },
  // For autodocs, use OpenAPI schema,
  openapi: (app: App) => {
    return {
      title: 'Blurr',
      version: '1.0.0',
      description: 'A web framework for Bun',
      routes: app.routes
    };
  }
});
```

Here's how to run:

```ts
app.listen(
  {
    host: '127.0.0.1',
    port: 3000,
    debug: true
  },
  async () => {
    console.log('Listening on port 3000');
  }
);
```

## App event handlers

```ts
app.on_event('startup', async () => {
  app.state.client = new Client();
});

app.on_event('shutdown', async () => {
  app.state.client.stop();
});

app.on_event('before-request', async (req: Request) => {
  // Do something before the request is sent
});
```

Handling errors globally:

```ts
import type { BlurrRequest, BlurrError } from 'blurr';

app.on_error((request: BlurrRequest, error: BlurrError) => {
  // Each error will have the route, the actual error
  // and the stack trace.
  console.log(error.route, error.message, error.stack);
});
```

## Routes

The routes are completely free of `res`, and lets you have optional request aswell!

```ts
import { Response } from 'blurr';

import type { BlurrRequest } from 'blurr';

app.get('/health', async _ => {
  return {
    json: {
      status: 'ok'
    }
  };
});

app.get('/test', async (req: BlurrRequest) => {
  // Maybe have type-safe access to the request?
  const { name } = req.params;

  return {
    json: {
      name
    }
  };
});

app.get('/test-500', async (req: BlurrRequest) => {
  return {
    response: {
      status: 500,
      json: {
        error: 'Internal server error'
      }
    }
  };

  // OR send text
  return {
    response: {
      status: 500,
      text: 'Internal server error'
    }
  };
});

app.get('/text-resp', async (req: BlurrRequest) => {
  return {
    text: 'Hello world'
  };
});
```

Dynamic route parameters:

```ts
app.get(
  '/test/:name',
  async (req: BlurrRequest) => {
    const { name } = req.params;

    return {
      json: {
        name
      }
    };
  },
  // The parameter config section is completely OPTIONAL
  {
    params: {
      name: {
        // Type is optional
        /*
        Types possible:
        - string/str
        - int
        - float
        - slug
        - path
        - date
        - uuid
        - custom regex
      */
        type: 'string',
        // Default value is false
        required: true
      },
      // Shorthand for this
      name: 'string'
    }
  }
);

app.post(
  '/test',
  async (req: BlurrRequest) => {
    const { name } = req.params;

    return {
      json: {
        name
      }
    };
  },
  // This is the schema now for the body
  {
    /*
        Types possible:
        - string/str
        - int
        - float
        - slug
        - path
        - date
        - uuid
        - object
        - custom regex
        - objects with nested typing
      */
    schema: {
      type: 'object',
      fields: {
        name: 'string'
      }
    }
  }
);
```

## URL redirection

```ts
app.get(
  '/health',
  async _ => {
    return {
      json: {
        status: 'ok'
      }
    };
  },
  {
    // Extra config for each route. Each can have an unique name
    config: {
      name: 'health'
    }
  }
);

app.get('/redirect', async _ => {
  return {
    redirect: app.url_for('health', {
      // Extra params?
      name: 'John Doe'
    })
  };
});
```

## Routers/Blueprints to organize the filesystem

```ts
import { Router } from 'blurr';

const router = new Router({
  name: 'health-router',
  urlPrefix: '/health'
});

router.get('/', async _ => {
  return {
    json: {
      status: 'ok'
    }
  };
});

// Load the router in the main app
app.register(router);
```

The root router created when making a Blurr app is as so - `new Router('root')`.

No URL prefixes or colliding names. Also, note that, router is going to be used for routing, the root router URLs can be accessed by `app.url_for('my-route')`, and others as, `app.url_for('router-name.my-route')`.

There can be a nested way to generate the URLs aswell, `v1-router.health.ping`

## Websocket routes

## Templating & static files

## Middlewares

## Background tasks

## Versioning

## Dependency injection

## GraphQL

## Type-safe endpoints
