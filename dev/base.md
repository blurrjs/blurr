## Basic App

### Initializing the App

```ts
import { Eviate } from 'eviate';

const app = new Eviate();
```

### Kitchen sink configuration

```ts
import type { App } from 'eviate';

const db = new Database();

const app = new Eviate({
  // The types in the state are preserved. Figure out a way to achieve so
  state: {
    name: 'John Doe',
    db: db
  },
  // Autogenerated redoc/swagger docs - decide which, or allow both?
  docs: {
    redoc: '/redoc',
    swagger: '/swagger'
  },
  // For autodocs, use OpenAPI schema,
  openapi: (app: App) => {
    return {
      title: 'Eviate',
      version: '1.0.0',
      description: 'A web framework for Bun',
      routes: app.routes
    };
  }
});
```

### Run the app

```ts
app.listen({
  host: '127.0.0.1',
  port: 3000,
  debug: true
});
```

## App event handlers

```ts
app.on_event('startup', async ({ port }) => {
  app.state.client = new Client();

  console.log(`Listening on port ${port}`);
});

app.on_event('shutdown', async () => {
  app.state.client.stop();
});

app.on_event('before-request', async (req: Request) => {
  // Do something before the request is sent
});
```

### Global error handler

```ts
import type { Context, EviateError } from 'eviate';

app.on_error((ctx: Context, error: EviateError) => {
  // Each error will have the route, the actual error
  // and the stack trace.
  console.log(error.route, error.message, error.stack);
});
```

## Routes

The routes are completely free of `res`, and lets you have optional request aswell!

The routes remove `req`, `res` and replaces with a simple `ctx` object to make working easy.

```ts
import type { Context } from 'eviate';

app.get('/health', async _ => {
  return {
    json: {
      status: 'ok'
    }
  };
});

app.get('/test', async (ctx: Context) => {
  // Maybe have type-safe access to the request?
  const { name } = ctx.params;

  return {
    json: {
      name
    }
  };
});

app.get('/test-500', async (ctx: Context) => {
  return {
    response: {
      status: 500,
      json: {
        error: 'Internal server error'
      }
    }
  };

  // OR send text
  return {
    response: {
      status: 500,
      text: 'Internal server error'
    }
  };
});

app.get('/text-resp', async (ctx: Context) => {
  return {
    text: 'Hello world'
  };
});
```

Dynamic route parameters:

```ts
app.get(
  '/test/:name',
  async (ctx: Context) => {
    const { name } = ctx.params;

    return {
      json: {
        name
      }
    };
  },
  // The parameter config section is completely OPTIONAL
  {
    params: {
      name: {
        // Type is optional
        /*
        Types possible:
        - string/str
        - int
        - float
        - slug
        - path
        - date
        - uuid
        - custom regex
      */
        type: 'string',
        // Default value is false
        required: true
      },
      // Shorthand for this
      name: 'string'
    }
  }
);

app.post(
  '/test',
  async (ctx: Context) => {
    const { name } = ctx.params;

    return {
      json: {
        name
      }
    };
  },
  // This is the schema now for the body
  {
    /*
        Types possible:
        - string/str
        - int
        - float
        - slug
        - path
        - date
        - uuid
        - object
        - custom regex
        - objects with nested typing
      */
    schema: {
      type: 'object',
      fields: {
        name: 'string'
      }
    }
  }
);
```

## URL redirection

```ts
app.get(
  '/health',
  async _ => {
    return {
      json: {
        status: 'ok'
      }
    };
  },
  {
    // Extra config for each route. Each can have an unique name
    config: {
      name: 'health'
    }
  }
);

app.get('/redirect', async _ => {
  return {
    redirect: app.url_for('health', {
      // Extra params?
      name: 'John Doe'
    })
  };
});
```

## Routers/Blueprints to organize the filesystem

```ts
import { Router } from 'eviate';

const router = new Router({
  name: 'health-router',
  urlPrefix: '/health'
});

router.get('/', async _ => {
  return {
    json: {
      status: 'ok'
    }
  };
});

// Load the router in the main app
app.register(router);
```

The root router created when making a Eviate app is as so - `new Router('root')`.

No URL prefixes or colliding names. Also, note that, router is going to be used for routing, the root router URLs can be accessed by `app.url_for('my-route')`, and others as, `app.url_for('router-name.my-route')`.

There can be a nested way to generate the URLs aswell, `v1-router.health.ping`

## Websocket routes

## Middlewares

## Templating & static files
